/*
 Systeemilahendus Datel AS
 http://www.datel.ee
*/
var InAadress;
InAadress=function(U){function Aa(){var a=!1;if(!c)return alert("Missing json init parameters!"),!1;if(c.container){if(null==document.getElementById(c.container))return alert("Container "+c.container+" doesn't exist!"),!1;k=c.container+"Map";c.container="#"+c.container}else return alert("Missing container parameter!"),!1;if(!c.mode)return alert("Missing mode parameter!"),!1;if(isNaN(c.mode)||0>c.mode||4<c.mode)return alert("Incorrect mode parameter!"),!1;if(c.searchLayers){if(!1===c.searchLayers instanceof Array)return alert("Incorrect searchLayers parameter. Must be array of layer names!"),
!1;c.searchLayers.forEach(function(c){if(0>ia.indexOf(c))return alert("unknown searchLayer: "+c+"!"),a=!0,!1})}if(c.WMS&&!1===c.WMS instanceof Array)return alert("Incorrect WMS parameter. Must be array of WMS url's!"),!1;if(3!=c.mode){if(c.baseLayers){if(!1===c.baseLayers instanceof Array)return alert("Incorrect baseLayers parameter. Must be array of layer names!"),!1;var b;c.baseLayers.forEach(function(c){if(!ja[c])return b=c,a=!0,!1});if(b)return alert("unknown baseLayer: "+b+"!"),!1}else return alert("Missing baseLayers parameter!"),
!1;if(!c.defaultBaseLayer)return alert("missing defaultBaseLayer parameter!"),!1;if(c.defaultBaseLayer&&0>c.baseLayers.indexOf(c.defaultBaseLayer))return alert("unknown defaultBaseLayer: "+c.defaultBaseLayer+"!"),!1;if(c.mapLayers){if(!1===c.mapLayers instanceof Array)return alert("Incorrect mapLayers parameter. Must be array of layer names!"),!1;c.mapLayers.forEach(function(c){if(0>Ba.indexOf(c))return alert("unknown mapLayer: "+c+"!"),a=!0,!1})}}if(c.tools){if(!1===c.tools instanceof Array)return alert("Incorrect tools parameter. Must be array of tools's!"),
!1;var f;c.tools.forEach(function(c){if(!D[c])return f=c,a=!0,!1});if(f)return alert("unknown tool: "+f+"!"),!1}if(c.appartment&&(isNaN(c.appartment)||0>c.appartment||2<c.appartment))return alert("Incorrect appartment parameter!"),!1;if(a)return!1;for(var d=0;d<document.scripts.length;d++)if(-1<document.scripts[d].src.indexOf("js/inaadress.js")){p=document.scripts[d].src.substring(0,document.scripts[d].src.indexOf("js/inaadress.js"));A=p+"gazetteer";break}else if(-1<document.scripts[d].src.indexOf("js/inaadress.min.js")){p=
document.scripts[d].src.substring(0,document.scripts[d].src.indexOf("js/inaadress.min.js"));A=p+"gazetteer";break}p||(p=top.location.href,"/"!=p.substring(p.length-1)&&(p+="/"),A=p+"gazetteer");return!0}function ka(){function a(){l.size=l.getCurrentSize();for(var a=0,c=l.layers.length;a<c;a++)l.layers[a].onMapResize();a=l.getCachedCenter();null!=l.baseLayer&&null!=a&&(c=l.getZoom(),l.zoom=null,l.setCenter(a,c))}c.mode!=q.addressSearch&&(OpenLayers.Map.prototype.updateSize=function(){var c=this.getCurrentSize();
if(c&&!isNaN(c.h)&&!isNaN(c.w)){this.events.clearMouseCache();var b=this.getSize();null==b&&(this.size=b=c);c.equals(b)||(V&&clearTimeout(V),V=setTimeout(a,500))}})}function M(){return!0===c.fullscreenMode&&(c.mode==q.mapSearch||c.mode==q.mapOnly)}function Ca(){W(p+"theme/default/inaadress.css?ver="+R);W(p+"theme/default/style.mobile.css?ver="+R);c.nocss||W(p+"theme/default/jquery.mobile-1.4.3.css?ver="+R);c.mode==q.addressSearch?H(p+"js/jquery.min.js",function(){b=jQuery.noConflict();b("html").hasClass("ui-mobile")&&
(X=!1);b(document).bind("mobileinit",function(){b.mobile.pushStateEnabled=!1;b.mobile.hashListeningEnabled=!1;b.mobile.linkBindingEnabled=!1;b.mobile.ajaxEnabled=!1;b.mobile.autoInitializePage=!1});H(p+"js/jquery.mobile-1.4.3.min.js",function(){la()})}):H(p+"js/proj4js-compressed.js",function(){H(p+"js/OpenLayers.min.js",function(){H(p+"js/jquery.min.js",function(){b=jQuery.noConflict();b("html").hasClass("ui-mobile")&&(X=!1);b(document).bind("mobileinit",function(){b.mobile.pushStateEnabled=!1;b.mobile.hashListeningEnabled=
!1;b.mobile.linkBindingEnabled=!1;b.mobile.ajaxEnabled=!1;b.mobile.autoInitializePage=!1});H(p+"js/jquery.mobile-1.4.3.min.js",function(){la()})})})})}function la(){c.translations?(e=c.translations,ka(),Y()):b.ajax({url:A,dataType:"jsonp",crossDomain:!0,type:"POST",cache:!0,data:{translations:"inads",lang:c.lang?c.lang:"et"}}).then(function(a){null!=a&&(a.error?alert(a.error):e=a);ka();Y()})}function Da(){b.ajax({url:A,dataType:"jsonp",crossDomain:!0,type:"POST",cache:!0,data:{request:"ehakbbox",
ehak:c.ehak}}).then(function(a){c.ehakfilter=c.ehak;delete c.ehak;null!=a&&(a.error?alert(a.error):c.ehakbbox=a);Y()})}function Y(){c.ehak?Da():(X&&(b("html").removeClass("ui-mobile"),b(c.container).addClass("ui-mobile")),b(c.container).addClass("ui-page-theme-a in-address-container"),(c.mode==q.mapSearch||c.mode==q.mapSearchHidden||c.mode==q.mapOnly)&&b(c.container).height()&&(E=b(c.container).height()),c.mode!=q.mapSearch&&c.mode!=q.mapSearchHidden&&c.mode!=q.addressSearch||Ea(),c.mode!=q.mapSearch&&
c.mode!=q.mapSearchHidden&&c.mode!=q.mapOnly||Fa(),b.mobile.dialog.prototype.options.closeBtnText=e["inads.closeBtnText"],b('<div data-role="popup" data-close-btn-text="'+e["inads.closeBtnText"]+'" class="inAadressInfo ui-page-theme-a" data-close-btn-text data-overlay-theme="a"></div>').appendTo(c.container),u=b(c.container+" .inAadressInfo").popup({closeBtnText:e["inads.closeBtnText"]}),u.width(500>b(c.container).width()?b(c.container).width()-40+"px":"500px"))}function Ea(){var a=b('<div alignt="left"/>').appendTo(c.container);
a.addClass("inaadressSearchContainer");a=b("<div/>").appendTo(a);a.addClass("inaadressSearch");C=b('<ul style="z-index:1100"/>').appendTo(a);C.listview({inset:!0,icon:!1,clearBtnText:e["inads.clear"]});C.filterable({defaults:!0,filterReveal:!0,filterPlaceholder:e["inads.search"],filterTheme:"a"});C.on("filterablebeforefilter",function(a,c){Z(b(this),c.input[0].value)});M()&&C.wrap("<div class='inaadressSearchContainerOuter'></div>");if(c.appartment==F.all||c.appartment==F.allowed)a=b("<select/>").appendTo(a),
a.addClass("appartments"),S=a.selectmenu(),b(c.container+" .inaadressSearch .ui-select").hide();c.mode==q.addressSearch&&b('<div class="inAdsCopyright"/>').appendTo(c.container+" .inaadressSearchContainer").html('<a href="'+p+'" target="_blank">In-ADS ('+e["inads.maaamet"]+")</a>");b(c.container).height(b(c.container+" .inaadressSearchContainer").height());b(c.container+" .inaadressSearchContainer input").keyup(function(a){13==a.which&&Z(C,this.value)});b(c.container+" .inaadressSearchContainer input").focus(function(){M()&&
Z(C,this.value)});$&&I($)}function Fa(){c.hideLogo&&(v=0);var a=E;M()&&(a=aa(),J=String(b("body").attr("style")),K=String(b(c.container).attr("style")),b("body").attr("style","margin:0"),b(c.container).attr("style","z-index:1;position:fixed;top:0;left:0;width:100%;height:"+a+"px"));var g;b(c.container).height(a);0<b(c.container+" .inaadressSearchContainer").length?(b(c.container+" .inaadressSearchContainer").before('<div id="'+k+'"/>'),g=a-ba-v,b(c.container+" #"+k).height(g)):(b("<div/>",{id:k}).appendTo(c.container),
b(c.container+" #"+k).height(a-v));b(c.container+" #"+k).css("position","relative");c.hideLogo||b(c.container+" #"+k).before('<a href="'+p+'" target="_blank"><div class="inAadressLogo"/></a>');if(c.baseLayers&&1<c.baseLayers.length){b(c.container+" #"+k).append('<div class="inAadressBaseMap"/>');for(var a='<select class="inAadressBaseMapSelect">',f=0;f<c.baseLayers.length;f++)a+='<option value="'+c.baseLayers[f]+'" '+(c.baseLayers[f]==c.defaultBaseLayer?"selected":"")+">"+e["inads."+c.baseLayers[f]]+
"</option>";a+="</select>";b(c.container+" .inAadressBaseMap").html(a);b(c.container+" .inAadressBaseMapSelect").selectmenu();b(c.container+" .inAadressBaseMapSelect").change(function(){l.getLayersByName("maaamet")[0].params.LAYERS=ma();l.baseLayer.redraw(!0)})}b(c.container+" #"+k).is(":visible")?(OpenLayers.Control.ScaleLine.prototype.update=function(){var a=this.map.getResolution();if(a){var c=this.map.getUnits(),f=OpenLayers.INCHES_PER_UNIT,g=this.maxWidth*a*f[c],e=1;!0===this.geodesic&&(e=(this.map.getGeodesicPixelSize().w||
1E-6)*this.maxWidth/(g/f.km),g*=e);var r,y;1E5<g?(r=this.topOutUnits,y=this.bottomOutUnits):(r=this.topInUnits,y=this.bottomInUnits);var k=g/f[r],n=g/f[y],g=this.getBarLen(k),na=this.getBarLen(n),k=g/f[c]*f[r],n=na/f[c]*f[y],c=k/a/e,a=n/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(a)+"px",this.eBottom.innerHTML=na+" "+y);"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(c)+"px",this.eTop.innerHTML=g+" "+r);r=50>c?50:c;b(".scalebarBackground").width(r+
20);b(".scalebarBackground").height(b(this.eTop).height()+b(this.eBottom).height()+23);b(".dogisMapScalebar").text("1:"+Math.round(l.getScale()))}},l=new OpenLayers.Map({div:k,theme:null,units:"m",projection:new OpenLayers.Projection("EPSG:3301",{yx:!0}),maxExtent:[345500,6378520,784950,6634140],fractionalZoom:!0,restrictedExtent:[345500,637E4,784950,663E4],controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!1},handleRightClicks:!1,mouseWheelOptions:{interval:0}})],layers:[new OpenLayers.Layer.WMS("maaamet",
p+"map",null,{DEFAULT_PARAMS:{version:"1.1.1",request:"GetMap",styles:"",layers:ma(),format:"image/png",transparent:!1},singleTile:!0,isBaseLayer:!0,buffer:0,transitionEffect:"resize",maxResolution:"auto",restrictedExtent:[345500,637E4,784950,663E4],maxExtent:[345500,6378520,784950,6634140],ratio:1})]}),b(c.container+" #"+k).append('<div class="inAadressCopyright">'+e["inads.maaamet"]+"</div>"),l.events.register("moveend",null,function(){var a=l.getExtent(),c=document.createEvent("CustomEvent");c.initCustomEvent("mapNavigate",
!0,!0,[a.left.toFixed(2),a.bottom.toFixed(2),a.right.toFixed(2),a.top.toFixed(2)]);document.dispatchEvent(c)}),c.showScale&&(l.addControl(new OpenLayers.Control.ScaleLine({bottomInUnits:""})),b("#"+k).append('<div class="scalebarBackground"></div>'),b("#"+k).append('<div class="dogisMapScalebar"></div>')),OpenLayers.Icon.prototype.setTooltip=function(a){a&&this.imageDiv.setAttribute("title",a)},Ga(),Ha(),b(window).resize(function(){if(M()){var a=aa();b(c.container).height(a);0<b(c.container+" .inaadressSearchContainer").length?
(g=a-ba-v,b(c.container+" #"+k).height(g),b(c.container+" .inaadressSearch .ui-select").is(":visible")?b(c.container+" .inaadressSearch").width(b(c.container).width()-110):b(c.container+" .inaadressSearch").width(b(c.container).width())):b(c.container+" #"+k).height(a-v)}}),setTimeout(function(){oa()},100)):alert("InADS container must be visible during initialisation!")}function Ga(){if(c.WMS)for(var a=0;a<c.WMS.length;a++){var b=c.WMS[a].split("?");2!=b.length&&alert("Invalid third party WMS url");
var f=b[1].toLowerCase().split("layers=");2!=f.length&&alert("Missing third party WMS layers");var f=f[1].split("&")[0],d=b[1].toLowerCase().split("version=");2!=d.length&&alert("Missing third party WMS version number");d=d[1].split("&")[0];b=new OpenLayers.Layer.WMS("thirdparty_"+a,b[0],null,{DEFAULT_PARAMS:{version:d,request:"GetMap",styles:"",layers:f,format:"image/png",transparent:!0},singleTile:!0,isBaseLayer:!1,buffer:0,visibility:1,transitionEffect:"resize",ratio:1});l.addLayers([b])}}function oa(){if(l.projection.getUnits()){c.ehakbbox?
l.zoomToExtent(new OpenLayers.Bounds(c.ehakbbox[0],c.ehakbbox[1],c.ehakbbox[2],c.ehakbbox[3]),!0):c.markers&&c.markers.bbox?l.zoomToExtent(new OpenLayers.Bounds(c.markers.bbox[0],c.markers.bbox[1],c.markers.bbox[2],c.markers.bbox[3]),!0):l.zoomToMaxExtent();b(c.container+" #"+k).append('<div id="OpenLayers_Control_Zoom_3" class="olControlZoom olControlNoSelect" unselectable="on" style="position: absolute; z-index: 1002;">');b(c.container+" .olControlZoom").append('<a href="#zoomIn" class="olControlZoomIn olButton">+</a>');
b(c.container+" .olControlZoom").append('<a href="#zoomOut" class="olControlZoomOut olButton">\u2212</a>');c.noInfo||(b(c.container+" .olControlZoom").append('<a title="'+e["inads.infoBtn"]+'" href="javascript:;" class="inAadressInfoBtn'+(!0===pa?" active":"")+'">i</a>'),c.tools&&0<c.tools.length&&b(".inAadressInfoBtn").addClass("corner"));c.tools&&1==c.tools.length?Ia(c.tools[0]):c.tools&&1<c.tools.length&&Ja();b(c.container+" .olControlZoomIn").click(function(){l.zoomIn()});b(c.container+" .olControlZoomOut").click(function(){l.zoomOut()});
b(c.container+" .inAadressInfoBtn").click(function(){b(this).toggleClass("active");qa();if(b(c.container+" .inAadressTool").hasClass("active")){b(c.container+" .inAadressTool").removeClass("active");var a=document.createEvent("CustomEvent");a.initCustomEvent("unSelectedTool",!0,!0,null);document.dispatchEvent(a);N()}});if(c.mode==q.mapSearchHidden){b(c.container+" .inaadressSearchContainer").before('<div id="showHideMap"><input id="showHideMapBtn" type="button" value="'+(ca?e["inads.hidemap"]:e["inads.showmap"])+
'">');b(c.container+" #showHideMapBtn").button({mini:!0});var a=E-b(c.container+" .inaadressSearchContainer").height()-b(c.container+" #showHideMap").height()-v;b(c.container+" #"+k).height(a);ca||(b(c.container+" #"+k).hide(),b(c.container).height(b(c.container+" #showHideMap").height()+b(c.container+" .inaadressSearchContainer").height()+v));b(c.container+" #showHideMapBtn").click(function(){b(c.container+" #"+k).toggle();b(c.container).height(b(c.container+" #"+k).is(":visible")?E:b(c.container+
" #showHideMap").height()+b(c.container+" .inaadressSearchContainer form").height()+v);b(c.container+" #showHideMapBtn").val(b(c.container+" #showHideMapBtn").val()==e["inads.showmap"]?e["inads.hidemap"]:e["inads.showmap"]);b(c.container+" #showHideMapBtn").button("refresh")})}n=new OpenLayers.Layer.Markers("MarkerLayer");l.addLayers([n]);a=new OpenLayers.Style({graphicWidth:32,graphicHeight:37,graphicXOffset:-16,graphicYOffset:-37,graphicOpacity:1,externalGraphic:p+"theme/default/img/temp/star.png",
label:"${title}",labelAlign:"cc",labelOutlineColor:"white",fontFamily:"Arial",fontSize:"14px",labelOutlineWidth:1,labelYOffset:-10});B=new OpenLayers.Layer.Vector("customMarkerLayer");B.styleMap=new OpenLayers.StyleMap({"default":a});l.addLayers([B]);a=document.createEvent("CustomEvent");a.initCustomEvent("inaadressLoaded",!0,!0,null);document.dispatchEvent(a);c.mode==q.mapOnly&&c.ads_oid&&ra(c.ads_oid,c.bbox);c.markers&&sa(c.markers.addresses)}else setTimeout(function(){oa()},100)}function Ia(a){-1<
a.indexOf(D.measure)?b(c.container+" .olControlZoom").append('<a title="'+e["inads.measureBtn"]+'" href="javascript:;" class="inAadressMeasure inAadressTool '+(c.noInfo?"corner":"")+'"></a>'):-1<a.indexOf(D.edit)?b(c.container+" .olControlZoom").append('<a title="'+e["inads.editBtn"]+'" href="javascript:;" class="inAadressEdit inAadressTool '+(c.noInfo?"corner":"")+'"></a>'):-1<a.indexOf(D.draw)&&b(c.container+" .olControlZoom").append('<a title="'+e["inads.drawBtn"]+'" href="javascript:;" class="inAadressDraw inAadressTool '+
(c.noInfo?"corner":"")+'"></a>');b(c.container+" .inAadressTool").click(function(){b(c.container+" .inAadressInfoBtn").removeClass("active");b(this).toggleClass("active");var a;b(this).hasClass("active")?b(this).hasClass("inAadressEdit")?(a=document.createEvent("CustomEvent"),a.initCustomEvent("editToolSelected",!0,!0,null),document.dispatchEvent(a)):b(this).hasClass("inAadressDraw")?(a=document.createEvent("CustomEvent"),a.initCustomEvent("drawToolSelected",!0,!0,null),document.dispatchEvent(a)):
b(this).hasClass("inAadressMeasure")&&ta():(a=document.createEvent("CustomEvent"),a.initCustomEvent("unSelectedTool",!0,!0,null),document.dispatchEvent(a),N())})}function Ja(){b(c.container+" .olControlZoom").append('<a title="'+e["inads.chooseToolBtn"]+'" href="javascript:;" class="inAadressToolselector '+(c.noInfo?"corner":"")+'"></a>');b(c.container+" #"+k).append('<div class="olControlTool '+(c.noInfo?"noInfo":"")+'" style="display: none"></div>');-1<c.tools.indexOf(D.measure)&&b(c.container+
" .olControlTool").append('<a title="'+e["inads.measureBtn"]+'" href="javascript:;" class="inAadressMeasure inAadressTool"></a>');-1<c.tools.indexOf(D.draw)&&b(c.container+" .olControlTool").append('<a title="'+e["inads.drawBtn"]+'" href="javascript:;" class="inAadressDraw inAadressTool"></a>');-1<c.tools.indexOf(D.edit)&&b(c.container+" .olControlTool").append('<a title="'+e["inads.editBtn"]+'" href="javascript:;" class="inAadressEdit inAadressTool"></a>');b(c.container+" .inAadressToolselector").click(function(){b(c.container+
" .olControlTool").is(":visible")||b(c.container+" .inAadressToolselector").hasClass("active")?b(c.container+" .olControlTool").hide():b(c.container+" .olControlTool").show();qa()});b(c.container+" .inAadressTool").click(function(){b(c.container+" .olControlTool").hide();b(c.container+" .inAadressInfoBtn").removeClass("active");b(c.container+" .inAadressToolselector").removeClass("inAadressMeasure");b(c.container+" .inAadressToolselector").removeClass("inAadressEdit");b(c.container+" .inAadressToolselector").removeClass("inAadressDraw");
b(c.container+" .inAadressToolselector").addClass("active");var a;b(this).hasClass("inAadressEdit")?(b(c.container+" .inAadressToolselector").addClass("inAadressEdit"),a=document.createEvent("CustomEvent"),a.initCustomEvent("editToolSelected",!0,!0,null),document.dispatchEvent(a),N()):b(this).hasClass("inAadressDraw")?(b(c.container+" .inAadressToolselector").addClass("inAadressDraw"),a=document.createEvent("CustomEvent"),a.initCustomEvent("drawToolSelected",!0,!0,null),document.dispatchEvent(a),
N()):b(this).hasClass("inAadressMeasure")&&(b(c.container+" .inAadressToolselector").addClass("inAadressMeasure"),a=document.createEvent("CustomEvent"),a.initCustomEvent("unSelectedTool",!0,!0,null),document.dispatchEvent(a),ta())})}function qa(){b(c.container+" .inAadressToolselector").removeClass("inAadressMeasure");b(c.container+" .inAadressToolselector").removeClass("inAadressEdit");b(c.container+" .inAadressToolselector").removeClass("inAadressDraw");if(b(c.container+" .inAadressToolselector").hasClass("active")){b(c.container+
" .inAadressToolselector").removeClass("active");var a=document.createEvent("CustomEvent");a.initCustomEvent("unSelectedTool",!0,!0,null);document.dispatchEvent(a);N()}}function ta(){function a(){var a=0,g=0;if(t.handler.line){var h=t.handler.line.geometry;if(2>h.components.length)return;a=h.getLength();if(2<h.components.length){for(var w=new OpenLayers.Geometry.LinearRing,m=0;m<h.components.length;m++)w.addComponent(h.components[m]);w.addComponent(h.components[0]);g+=w.getArea()}}for(h=0;h<t.layer.features.length;h++)if(a+=
t.layer.features[h].geometry.getLength(),2<t.layer.features[h].geometry.components.length){w=new OpenLayers.Geometry.LinearRing;for(m=0;m<t.layer.features[h].geometry.components.length;m++)w.addComponent(t.layer.features[h].geometry.components[m]);w.addComponent(t.layer.features[h].geometry.components[0]);g+=w.getArea()}a=1E3<a?(a/1E3).toFixed(2)+"km":a.toFixed(2)+"m";g=Math.abs(g);1E6<g?g=(g/1E6).toFixed(2)+"km<sup>2</sup>":0<g&&(g=g.toFixed(2)+"m<sup>2</sup>");b(c.container+" .measureResults").html(e["inads.measureLine"]+
": "+a);g&&0!=g&&b(c.container+" .measureResults").append("<br/>"+e["inads.measureArea"]+": "+g)}if(t)t.activate(),b(c.container+" .measureResults").html(""),b(c.container+" .measureResults").show();else{b("#"+k).append('<div class="measureResults"></div>');L=new OpenLayers.Layer.Vector("Measure");var g=new OpenLayers.Style({pointRadius:5,graphicName:"circle",strokeWidth:2,strokeOpacity:1,fillOpacity:.3,fillColor:"#FFFFFF",strokeColor:"#FF0000"});L.styleMap=new OpenLayers.StyleMap({"default":g,temporary:g,
select:g});L.events.register("sketchmodified",void 0,a);l.addLayers([L]);t=new OpenLayers.Control.DrawFeature(L,OpenLayers.Handler.Path);l.addControl(t);t.activate()}}function N(){t&&(t.deactivate(),L.removeAllFeatures(),b(c.container+" .measureResults").hide())}function ma(){var a=b(c.container+" .inAadressBaseMapSelect option:selected").val();a||(a=c.defaultBaseLayer);a=""+ja[a];a+=c.mapLayers&&-1<c.mapLayers.indexOf("KATASTRIYKSUS")?",TOPOYKSUS_6569":"";return a+=c.mapLayers&&-1<c.mapLayers.indexOf("AADRESS")?
",aadr":""}function Ha(){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){c.mode==q.mapOnly&&c.ads_oid&&!b(c.container+" .inAadressInfoBtn").hasClass("active")||
b(c.container+" .inAadressToolselector").hasClass("active")||b(c.container+" .inAadressTool").hasClass("active")||!b(c.container+" .inAadressInfoBtn").hasClass("active")&&c.noAddressMapSelect||(b(c.container+" .inAadressInfoBtn").hasClass("active")||n.clearMarkers(),a=l.getLonLatFromPixel(a.xy),da(a.lon,a.lat,!0))}});ea=new OpenLayers.Control.Click;l.addControl(ea);ea.activate()}function da(a,g,f){G=new OpenLayers.LonLat(a,g);var d=c.searchLayers&&0<c.searchLayers.length?c.searchLayers.join(","):
"";c.mode==q.mapOnly&&(d=ia.join(","));b.ajax({url:A,dataType:"jsonp",crossDomain:!0,seq:z,cache:!0,data:{features:d,appartment:null!=c.appartment?c.appartment:"0",x:a,y:g}}).then(function(a){if(null!=a){var g=a.addresses;if(a.error)alert(a.error);else if(g&&0<g.length)if(g=ua(g),f&&b(c.container+" .inAadressInfoBtn").hasClass("active")){var d='<div class="inAdsInfoContent" style="max-height: '+(b(c.container+" #"+k).height()-10)+'px">',s=!1;b.each(g,function(a,c){if(c){if(s)return!0;c.showaadress=
O(c.taisaadress);var b=c.ads_oid.substring(0,2);if("LO"==b||"AY"==b||"OV"==b||"MK"==b)s=!0;d+='<table class="info_'+b+'">';d+="<tr><td>"+e["inads.infoAadress"]+":</td><td>";b=c.showaadress.split(",");d+="<b>"+b[0]+"</b>"+(1<b.length?", "+b.slice(1).join(","):"");d+="</td></tr>";d+="<tr><td>"+e["inads.infoLiik"]+":</td><td>"+va(c.liikVal,c.ads_oid)+"</td></tr>";d+="<tr><td>"+e["inads.infoTunnus"]+":</td><td>"+c.tunnus+"</td></tr>";d+="<tr><td>"+e["inads.infoAds"]+":</td><td>"+c.ads_oid+"</td></tr>";
d+="</table>"}});d+="</div>";u.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">'+e["inads.closeBtnText"]+"</a>"+d).popup("open",{positionTo:"#"+k})}else{if(c.mode!=q.mapOnly||!c.ads_oid)if(P(),f?g=Ka(g):g.splice(1,g.length-1),1==g.length)g[0].showaadress=O(g[0].taisaadress),g[0].complete=!0,I(g[0].showaadress),Q(g[0],null,!0,0,G),fa(g[0]),b(c.container+" .inaadressSearch ul").html(""),x(g[0],G),f||(a=g[0].boundingbox.split(" "),
a=new OpenLayers.Bounds(a[0].split(",")[0],a[0].split(",")[1],a[2].split(",")[0],a[2].split(",")[1]),l.zoomToExtent(a,!0));else if(1<g.length){var r='<div class="inAdsInfoContent" style="max-height: '+(b(c.container+" #"+k).height()-10)+'px"><h3>'+e["inads.addressQuestion"]+'</h3><table class="inAdressSelectTable">',y=0,t=!0,v=g[0].taisaadress;b.each(g,function(a,c){c.taisaadress!=v&&(t=!1)});b.each(g,function(a,b){b&&(b.showaadress=O(b.taisaadress),r+='<tr value="'+y+'">',r+='<td><input type="radio" name="inAdsSelectAddress" value="'+
y+'" id="inAdsSelect_'+y+'"></td>',r+='<td><label for="inAdsSelect_'+y+'">'+(c.searchLayers&&0<c.searchLayers.length?ga(b.liikVal,b.ads_oid)+" - ":"")+b.showaadress,r+=(t?" ("+b.ads_oid+")":"")+"</label></td>",r+="</tr>",y++)});r+="</table></div>";r+='<input type="button" class="inAdsSelectBtn" value="'+e["inads.addressOk"]+'">';u.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>'+r);u.popup("open",{positionTo:"#"+
k});b(".inAdsInfoContent tr").mouseenter(function(){var a=g[b(this).attr("value")];a.viitepunkt_x&&a.viitepunkt_y&&(b(".inAadressInfo").addClass("inAadressPopupTransparent"),a=ha(a.viitepunkt_x,a.viitepunkt_y,p+"theme/default/img/temp/star.png",null,a),n.clearMarkers(),n.addMarker(a))});b(".inAdsInfoContent tr").mouseleave(function(){n.clearMarkers();b(".inAadressInfo").removeClass("inAadressPopupTransparent")});b(".inAdsSelectBtn").button();b(".inAdsSelectBtn").click(function(){var a=g[b("input[name='inAdsSelectAddress']:checked").val()];
a&&(a.complete=!0,I(a.showaadress),Q(a,null,!0,0,G),fa(a),b(c.container+" .inaadressSearch ul").html(""),u.popup("close"),x(a,G),f||(a=a.boundingbox.split(" "),a=new OpenLayers.Bounds(a[0].split(",")[0],a[0].split(",")[1],a[2].split(",")[0],a[2].split(",")[1]),l.zoomToExtent(a,!0)))})}}else f&&b(c.container+" .inAadressInfoBtn").hasClass("active")||(I(""),P(),b(c.container+" .inaadressSearch ul").html(""),b("<li/>").appendTo(b(c.container+" .inaadressSearch ul")).append('<a href="javascript:;" title="'+
e["inads.noresults"]+'">'+e["inads.noresults"]+"</a>"),b(c.container+" .inaadressSearch ul").listview("refresh"),b(c.container+" .inaadressSearch ul").trigger("updatelayout"),a=document.createEvent("CustomEvent"),a.initCustomEvent("noResultXY",!0,!0,{mapx:G.lat,mapy:G.lon}),document.dispatchEvent(a))}})}function O(a){a=a.split(", ");a.reverse();for(var c=0;c<a.length;c++)a[c]=b.trim(a[c]);return a=a.join(", ")}function ua(a){for(var c=0;c<a.length;c++)for(var b=a.length-1;b>c;b--)a[c].ads_oid==a[b].ads_oid&&
(a[c].oidAddresses||(a[c].oidAddresses=[]),a[c].oidAddresses.push(a[b]),a.splice(b,1));return a}function Ka(a){for(var c=a[0].liikVal,b=a.length-1;0<=b;b--)22.4506281793337<l.getResolution()?"EHAK"!=a[b].liikVal&&"VAIKEKOHT"!=a[b].liikVal&&a.splice(b,1):1.87462745297436<l.getResolution()?"EHITISHOONE"!=a[b].liikVal&&"EHITIS"!=a[b].liikVal&&"HOONE"!=a[b].liikVal||a.splice(b,1):a[b].liikVal!=c&&a.splice(b,1);return a}function Z(a,g){P();a.html("");n&&n.clearMarkers();if(g&&0<g.length){a.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");
a.listview("refresh");z++;var f=c.searchLayers&&0<c.searchLayers.length?c.searchLayers.join(","):"";b.ajax({url:A,dataType:"jsonp",crossDomain:!0,seq:z,cache:!0,data:{address:g,results:La,appartment:null!=c.appartment?c.appartment:"0",unik:!0==c.unHoone&&c.searchLayers&&0<c.searchLayers.length?"1":"0",features:f,ehak:c.ehakfilter}}).then(function(f){if(this.seq==z&&(a.html(""),null!=f)){var g=f.addresses;if(f.error)alert(f.error);else{if(g&&0<g.length){var w=0,m;b.each(g,function(f,d){if(d&&d.pikkaadress){for(var e=
d.pikkaadress.split(","),k=0;k<e.length;k++)e[k]=b.trim(e[k]);!d.kort_nr||c.appartment!=F.all&&c.appartment!=F.allowed||(e[e.length-1]+="-"+d.kort_nr,d.kort_ads_oid&&(d.pikkaadress=e.join(", ")));e.reverse();d.showaadress=e.join(", ");d.old_aadresstekst&&d.old_aadresstekst!=d.aadresstekst&&(d.showaadress="("+d.old_aadresstekst+") "+d.showaadress);var e=b("<li/>").appendTo(a),s=w;e.click(function(){Q(d,d.boundingbox,!0,g.length<=T?s:0);fa(d);1==w&&(I(d.showaadress),a.html(""));M()&&a.html("");x(d)});
c.mode!=q.addressSearch&&(e.mouseenter(function(){for(var a=0;a<n.markers.length;a++)if(n.markers[a].attributes.tehn_id2==d.tehn_id2){var c=ha(null,null,n.markers[a].icon.url,n.markers[a].lonlat,n.markers[a].attributes);c.icon.origUrl=c.icon.url;c.icon.url=c.icon.origUrl.substring(0,c.icon.origUrl.lastIndexOf("/"))+"/temp/"+c.icon.origUrl.substring(c.icon.origUrl.lastIndexOf("/")+1);n.removeMarker(n.markers[a]);n.addMarker(c);break}}),e.mouseleave(function(){for(var a=0;a<n.markers.length;a++)if(n.markers[a].attributes.tehn_id2==
d.tehn_id2&&n.markers[a].icon.origUrl){n.markers[a].icon.url=n.markers[a].icon.origUrl;var c=l.getLayerPxFromLonLat(n.markers[a].lonlat);n.markers[a].icon.draw(c)}}));k="";c.mode!=q.addressSearch&&g.length<=T&&d.viitepunkt_x&&d.viitepunkt_y&&(k='<img src="'+p+"theme/default/img/"+(26>g.length?"letter_"+wa[w]+".png":"star.png")+'" class="ui-li-icon ui-corner-none">');e.append('<a id="in_teh_'+d.tehn_id2+'" href="javascript:;" title="'+d.showaadress+'">'+k+" "+(c.searchLayers&&0<c.searchLayers.length?
ga(d.liikVal,d.kort_ads_oid?d.kort_ads_oid:d.ads_oid)+" - ":"")+d.showaadress+"</a>");g.length<=T&&Q(d,null,!1,w);d.boundingbox&&l&&(e=d.boundingbox.split(" "),m?(m.left>Number(e[0].split(",")[0])&&(m.left=Number(e[0].split(",")[0])),m.top<Number(e[2].split(",")[1])&&(m.top=Number(e[2].split(",")[1])),m.right<Number(e[2].split(",")[0])&&(m.right=Number(e[2].split(",")[0])),m.bottom>Number(e[0].split(",")[1])&&(m.bottom=Number(e[0].split(",")[1]))):m=new OpenLayers.Bounds(e[0].split(",")[0],e[0].split(",")[1],
e[2].split(",")[0],e[2].split(",")[1]));w++}});g.length<=T&&m&&l&&(f=.2*(m.right-m.left),m.left-=f,m.right+=f,f=.2*(m.top-m.bottom),m.bottom-=f,m.top+=f,l.zoomToExtent(m,!1))}else b("<li/>").appendTo(a).append('<a href="javascript:;" title="'+e["inads.noresults"]+'">'+e["inads.noresults"]+"</a>");a.listview("refresh");a.trigger("updatelayout")}}})}}function Q(a,b,f,d,h){if(c.mode!=q.addressSearch){if(a.viitepunkt_x&&a.viitepunkt_y||h)a=ha(a.viitepunkt_x,a.viitepunkt_y,p+"theme/default/img/"+(0>d?
"star.png":d?"letter_"+wa[d]+".png":"letter_a.png"),h,a),n&&(f&&n.clearMarkers(),n.addMarker(a));b&&l&&(b=b.split(" "),b=new OpenLayers.Bounds(b[0].split(",")[0],b[0].split(",")[1],b[2].split(",")[0],b[2].split(",")[1]),l.zoomToExtent(b,!1))}}function ha(a,g,f,d,h){a=new OpenLayers.LonLat(a,g);f=new OpenLayers.Icon(f,{w:32,h:37},{x:-16,y:-37});f.setTooltip(ga(h.liikVal,h.kort_ads_oid?h.kort_ads_oid:h.ads_oid)+" - "+O(h.taisaadress)+" ("+h.ads_oid+")");d=new OpenLayers.Marker(d?d:a,f);d.attributes=
h;d.events.register("click",d,function(){if(b(c.container+" .inAadressInfoBtn").hasClass("active")&&this.attributes){var a='<div class="inAdsInfoContent" style="max-height: '+(b(c.container+" #"+k).height()-10)+'px">';this.attributes.showaadress=O(this.attributes.taisaadress);var f=this.attributes.ads_oid.substring(0,2),a=a+('<table class="info_'+f+'">')+("<tr><td>"+e["inads.infoAadress"]+":</td><td>"),f=this.attributes.showaadress.split(","),a=a+("<b>"+f[0]+"</b>"+(1<f.length?", "+f.slice(1).join(","):
"")),a=a+"</td></tr>",a=a+("<tr><td>"+e["inads.infoLiik"]+":</td><td>"+va(this.attributes.liikVal,this.attributes.ads_oid)+"</td></tr>"),a=a+("<tr><td>"+e["inads.infoTunnus"]+":</td><td>"+this.attributes.tunnus+"</td></tr>"),a=a+("<tr><td>"+e["inads.infoAds"]+":</td><td>"+this.attributes.ads_oid+"</td></tr>"),a=a+"</table>",a=a+"</div>";u.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">'+e["inads.closeBtnText"]+"</a>"+
a).popup("open",{positionTo:"#"+k})}else x(this.attributes)});d.events.register("mouseover",d,function(){0<b(c.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').length&&b(c.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').addClass("active")});d.events.register("mouseout",d,function(){0<b(c.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').length&&b(c.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').removeClass("active")});return d}function xa(a,g,f){a&&!a.ads_oid?(a.complete=
!0,x(a)):(z++,b.ajax({url:A,dataType:"jsonp",crossDomain:!0,cache:!0,seq:z,data:{adsoid:null==g?a.kort_ads_oid?a.kort_ads_oid:a.ads_oid:g,unik:!0==c.unHoone&&c.searchLayers&&0<c.searchLayers.length?"1":"0"}}).then(function(d){if(this.seq==z&&null!=d){var h=d.addresses;if(d.error)alert(d.error);else if(g){u&&u.popup("close");h=ua(h);d=null;for(var e=0;e<h.length;e++)if(h[e].complete=!0,h[e].showaadress=h[e].pikkaadress,Q(h[e],null,!1,c.mode==q.mapOnly||26<=h.length?-1:e),h[e].boundingbox&&l&&(!f||
!isNaN(f))){var m=h[e].boundingbox.split(" ");d?d&&(d.left>Number(m[0].split(",")[0])&&(d.left=Number(m[0].split(",")[0])),d.top<Number(m[2].split(",")[1])&&(d.top=Number(m[2].split(",")[1])),d.right<Number(m[2].split(",")[0])&&(d.right=Number(m[2].split(",")[0])),d.bottom>Number(m[0].split(",")[1])&&(d.bottom=Number(m[0].split(",")[1]))):d=new OpenLayers.Bounds(m[0].split(",")[0],m[0].split(",")[1],m[2].split(",")[0],m[2].split(",")[1])}d&&l?(h=isNaN(f)?.2:Number(f),e=(d.right-d.left)*h,d.left-=
e,d.right+=e,h*=d.top-d.bottom,d.bottom-=h,d.top+=h,l.zoomToExtent(d,!1)):f&&isNaN(f)&&l&&(f=f.split(","),l.zoomToExtent(new OpenLayers.Bounds(f[0],f[1],f[2],f[3]),!1))}else h&&1==h.length?(a.taisaadress=a.showaadress=a.taisaadress,a.aadresstekst=h[0].aadresstekst,a.pikkaadress=h[0].pikkaadress,a.ipikkaadress=h[0].ipikkaadress,a.ads_oid=a.kort_ads_oid?h[0].kort_ads_oid:h[0].ads_oid,a.tunnus=a.kort_ads_oid?h[0].kort_orig_tunnus:h[0].tunnus,a.unik=a.kort_ads_oid?h[0].kort_unik:h[0].unik,a.koodaadress=
h[0].koodaadress,a.ehakmk=h[0].ehakmk,a.ehakov=h[0].ehakov,a.ehak=h[0].ehak,a.kood4=h[0].kood4,a.kood5=h[0].kood5,a.kood6=h[0].kood6,a.kood7=h[0].kood7,a.kood8=h[0].kood8,a.maakond=h[0].maakond,a.omavalitsus=h[0].omavalitsus,a.asustusyksus=h[0].asustusyksus,a.vaikekoht=h[0].vaikekoht,a.liikluspind=h[0].liikluspind,a.nimi=h[0].nimi,a.aadress_nr=h[0].aadress_nr,a.adob_id=a.kort_ads_oid?h[0].kort_adob_id:h[0].adob_id,a.adr_id=a.kort_ads_oid?h[0].kort_adr_id:h[0].adr_id,a.viitepunkt_y=h[0].viitepunkt_y,
a.viitepunkt_x=h[0].viitepunkt_x,a.viitepunkt_b=h[0].viitepunkt_b,a.viitepunkt_l=h[0].viitepunkt_l,a.complete=!0,x(a)):h&&1<h.length&&(a.taisaadress=a.showaadress=h[0].taisaadress,a.complete=!0,a.oidAddresses=[],b.each(h,function(c,b){if(b.adr_id&&a.adr_id&&b.adr_id==a.adr_id||b.kort_adr_id&&a.kort_adr_id&&b.kort_adr_id==a.kort_adr_id)return a.taisaadress=a.showaadress=b.taisaadress,a.aadresstekst=b.aadresstekst,a.pikkaadress=b.pikkaadress,a.ipikkaadress=b.ipikkaadress,a.ads_oid=a.kort_ads_oid?b.kort_ads_oid:
b.ads_oid,a.tunnus=a.kort_ads_oid?b.kort_orig_tunnus:b.tunnus,a.unik=a.kort_ads_oid?b.kort_unik:b.unik,a.koodaadress=b.koodaadress,a.ehakmk=b.ehakmk,a.ehakov=b.ehakov,a.ehak=b.ehak,a.kood4=b.kood4,a.kood5=b.kood5,a.kood6=b.kood6,a.kood7=b.kood7,a.kood8=b.kood8,a.maakond=b.maakond,a.omavalitsus=b.omavalitsus,a.asustusyksus=b.asustusyksus,a.vaikekoht=b.vaikekoht,a.liikluspind=b.liikluspind,a.nimi=b.nimi,a.aadress_nr=b.aadress_nr,a.adob_id=a.kort_ads_oid?b.kort_adob_id:b.adob_id,a.adr_id=a.kort_ads_oid?
b.kort_adr_id:b.adr_id,a.viitepunkt_y=b.viitepunkt_y,a.viitepunkt_x=b.viitepunkt_x,a.viitepunkt_b=b.viitepunkt_b,a.viitepunkt_l=b.viitepunkt_l,!0;a.kort_nr&&!a.kort_ads_oid&&(b.kort_nr=a.kort_nr);a.oidAddresses.push(b)}),x(a))}}))}function Ma(a){a.adr_id?(z++,b.ajax({url:A,dataType:"jsonp",crossDomain:!0,cache:!0,seq:z,data:{adrid:a.kort_adr_id?a.kort_adr_id:a.adr_id,unik:!0==c.unHoone&&c.searchLayers&&0<c.searchLayers.length?"1":"0"}}).then(function(c){if(this.seq==z&&null!=c){var f=c.addresses;
if(c.error)alert(c.error);else if(f&&0<f.length){a.complete=!0;if(a.kort_nr&&!a.kort_ads_oid)for(c=f.length-1;0<=c;c--)f[c].primary||f.splice(c,1);b.each(f,function(c,b){a.kort_nr&&!a.kort_ads_oid&&b.primary&&(b.kort_nr=a.kort_nr);a.kort_ads_oid&&(b.tunnus=b.kort_orig_tunnus,b.ads_oid=b.kort_ads_oid,b.unik=b.kort_unik,b.adob_id=b.kort_adob_id,b.adr_id=b.kort_adr_id);a.kort_nr&&a.kort_ads_oid&&a.kort_adr_id&&a.kort_ads_oid==b.kort_ads_oid&&a.kort_adr_id==b.kort_adr_id&&(a.taisaadress=a.showaadress=
b.taisaadress,a.aadresstekst=b.aadresstekst,a.pikkaadress=b.pikkaadress,a.ipikkaadress=b.ipikkaadress,a.ads_oid=b.ads_oid,a.tunnus=b.tunnus,a.unik=b.unik,a.koodaadress=b.koodaadress,a.ehakmk=b.ehakmk,a.ehakov=b.ehakov,a.ehak=b.ehak,a.kood4=b.kood4,a.kood5=b.kood5,a.kood6=b.kood6,a.kood7=b.kood7,a.kood8=b.kood8,a.maakond=b.maakond,a.omavalitsus=b.omavalitsus,a.asustusyksus=b.asustusyksus,a.vaikekoht=b.vaikekoht,a.liikluspind=b.liikluspind,a.nimi=b.nimi,a.aadress_nr=b.aadress_nr,a.adob_id=b.adob_id,
a.adr_id=b.adr_id,a.viitepunkt_y=b.viitepunkt_y,a.viitepunkt_x=b.viitepunkt_x,a.viitepunkt_b=b.viitepunkt_b,a.viitepunkt_l=b.viitepunkt_l);if(b.seosed&&0<b.seosed.length)for(c=0;c<b.seosed.length;c++)a.kort_nr&&!a.kort_ads_oid&&(b.seosed[c].kort_nr=a.kort_nr)});a.adrSeosed=f;x(a)}}})):(a.complete=!0,x(a))}function fa(a){if("E"==a.liik&&!a.kort_nr&&(c.appartment==F.all||c.appartment==F.allowed&&"1"==a.onkort&&a.appartments&&0<a.appartments.length)){b(c.container+" .inaadressSearch .ui-select").show();
var g;g=""+('<option value="" selected>'+e["inads.appartment"]+"</option>");if(a.appartments)for(var f=0;f<a.appartments.length;f++)g+='<option value="'+f+'">'+a.appartments[f].tahis+(0==a.appartments[f].ads_oid.indexOf("MR")?" (MR)":"")+"</option>";c.appartment==F.all&&(g+='<option value="muu">'+e["inads.customApparment"]+"</option>");s=a;ya||(ya=!0,b(c.container+" .appartments").bind("change",function(){if(""==this.value)x(s);else if("muu"==this.value){var a='<div class="inAdsInfoContent" style="max-height: '+
(b(c.container+" #"+k).height()-10)+'px"><h3>'+e["inads.appartmentQuestion"]+"</h3>",a=a+'<input type="text" name="name" class="inAdsAppartText" value="">'+('<input type="button" class="inAdsAppartSelectBtn" value="'+e["inads.appartmentOk"]+'">'),a=a+"</div>";u.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>'+a);c.mode==q.addressSearch?u.popup("open"):u.popup("open",{positionTo:"#"+k});b(".inAdsAppartSelectBtn").button();
b(".inAdsAppartText").textinput();b(".inAdsAppartSelectBtn").click(function(){var a=b(".inAdsAppartText").val().trim();if(a){var f;if(s.appartments&&0<s.appartments.length)for(f=0;f<s.appartments.length;f++)if(s.appartments[f].tahis==a){a=jQuery.extend(!0,{},s);delete a.complete;delete a.adrSeosed;delete a.oidAddresses;a.kort_nr=s.appartments[f].tahis;a.kort_ads_oid=s.appartments[f].ads_oid;a.kort_adr_id=s.appartments[f].adr_id;x(a);u.popup("close");b(c.container+" .appartments").val(f);S.selectmenu("refresh");
return}0==b(c.container+' .appartments option[value="m'+a+'"]').length&&b(c.container+' .appartments option[value="muu"]').before('<option value="m'+a+'">'+a+"</option>");b(c.container+" .appartments").val("m"+a);S.selectmenu("refresh");var g=jQuery.extend(!0,{},s);g.kort_nr=a;if(g.oidAddresses)for(f=0;f<g.oidAddresses.length;f++)g.oidAddresses[f].kort_nr=a;if(g.adrSeosed)for(f=g.adrSeosed.length-1;0<=f;f--)if(g.adrSeosed[f].primary){if(g.adrSeosed[f].kort_nr=a,g.adrSeosed[f].seosed)for(var d=0;d<
g.adrSeosed[f].seosed.length;d++)g.adrSeosed[f].seosed[d].kort_nr=a}else g.adrSeosed.splice(f,1);x(g);u.popup("close")}})}else a=jQuery.extend(!0,{},s),delete a.complete,delete a.adrSeosed,delete a.oidAddresses,s.appartments&&s.appartments[this.value]?(a.kort_nr=s.appartments[this.value].tahis,a.kort_ads_oid=s.appartments[this.value].ads_oid,a.kort_adr_id=s.appartments[this.value].adr_id):a.kort_nr=this.value.substring(1),x(a)}));b(c.container+" .appartments").html(g);S.selectmenu("refresh");b(c.container+
" .inaadressSearch").width(b(c.container).width()-110)}else P()}function x(a,b){if(a.complete){var f;if(a.adrSeosed){f=[];for(var d=0;d<a.adrSeosed.length;d++){var e=za(a.adrSeosed[d]);b&&(e.mapx=b.lat.toFixed(2),e.mapy=b.lon.toFixed(2));f.push(e)}}else f=za(a),b&&(f.mapx=b.lat.toFixed(2),f.mapy=b.lon.toFixed(2));document.createEvent&&document.dispatchEvent&&(d=document.createEvent("CustomEvent"),d.initCustomEvent("addressSelected",!0,!0,f),document.dispatchEvent(d))}else c.searchLayers&&0<c.searchLayers.length?
xa(a):Ma(a)}function za(a){var c,b;if(a.kort_nr){if(c={aadress:a.pikkaadress,paadress:a.ipikkaadress,lahiaadress:a.aadresstekst,liik:a.ads_oid.substring(0,2),kort_nr:a.kort_nr,orig_tunnus:a.tunnus,un_tunnus:a.unik,koodaadress:a.koodaadress,ehakmk:a.ehakmk,ehakov:a.ehakov,ehak:a.ehak,kood4:a.kood4,kood5:a.kood5,kood6:a.kood6,kood7:a.kood7,kood8:a.kood8,maakond:a.maakond,omavalitsus:a.omavalitsus,asustusyksus:a.asustusyksus,vaikekoht:a.vaikekoht,liikluspind:a.liikluspind,nimi:a.nimi,aadress_nr:a.aadress_nr,
ads_oid:a.ads_oid,adob_id:a.adob_id,adr_id:a.adr_id,x:a.viitepunkt_y?Number(a.viitepunkt_y).toFixed(2):"",y:a.viitepunkt_x?Number(a.viitepunkt_x).toFixed(2):"",b:a.viitepunkt_b?Number(a.viitepunkt_b):"",l:a.viitepunkt_l?Number(a.viitepunkt_l):""},a.kort_ads_oid||(c.uus_kort=!0,delete c.kood8),0<a.taisaadress.indexOf("//")&&(c.paralleelaadress=a.taisaadress),a.primary&&(c.primary=a.primary),a.oidAddresses||a.seosed)for(c.seotud=[],b=a.oidAddresses?a.oidAddresses:a.seosed,a=0;a<b.length;a++)c.seotud.push({aadress:b[a].pikkaadress,
paadress:b[a].ipikkaadress,lahiaadress:b[a].aadresstekst,liik:b[a].ads_oid.substring(0,2),kort_nr:b[a].kort_nr,uus_kort:!0,orig_tunnus:b[a].tunnus,un_tunnus:b[a].unik,koodaadress:b[a].koodaadress,ehakmk:b[a].ehakmk,ehakov:b[a].ehakov,ehak:b[a].ehak,kood4:b[a].kood4,kood5:b[a].kood5,kood6:b[a].kood6,kood7:b[a].kood7,maakond:b[a].maakond,omavalitsus:b[a].omavalitsus,asustusyksus:b[a].asustusyksus,vaikekoht:b[a].vaikekoht,liikluspind:b[a].liikluspind,nimi:b[a].nimi,aadress_nr:b[a].aadress_nr,ads_oid:b[a].ads_oid,
adob_id:b[a].adob_id,adr_id:b[a].adr_id,x:b[a].viitepunkt_y?Number(b[a].viitepunkt_y).toFixed(2):"",y:b[a].viitepunkt_x?Number(b[a].viitepunkt_x).toFixed(2):"",b:b[a].viitepunkt_b?Number(b[a].viitepunkt_b):"",l:b[a].viitepunkt_l?Number(b[a].viitepunkt_l):""})}else if(c={aadress:a.pikkaadress,paadress:a.ipikkaadress,lahiaadress:a.aadresstekst,liik:a.ads_oid.substring(0,2),orig_tunnus:a.tunnus,ads_oid:a.ads_oid,adob_id:a.adob_id,adr_id:a.adr_id,koodaadress:a.koodaadress,ehakmk:a.ehakmk,ehakov:a.ehakov,
ehak:a.ehak,kood4:a.kood4,kood5:a.kood5,kood6:a.kood6,kood7:a.kood7,maakond:a.maakond,omavalitsus:a.omavalitsus,asustusyksus:a.asustusyksus,vaikekoht:a.vaikekoht,liikluspind:a.liikluspind,nimi:a.nimi,aadress_nr:a.aadress_nr,un_tunnus:a.unik,x:a.viitepunkt_y?Number(a.viitepunkt_y).toFixed(2):"",y:a.viitepunkt_x?Number(a.viitepunkt_x).toFixed(2):"",b:a.viitepunkt_b?Number(a.viitepunkt_b):"",l:a.viitepunkt_l?Number(a.viitepunkt_l):""},0<a.taisaadress.indexOf("//")&&(c.paralleelaadress=a.taisaadress),
a.primary&&(c.primary=a.primary),a.oidAddresses||a.seosed)for(c.seotud=[],b=a.oidAddresses?a.oidAddresses:a.seosed,a=0;a<b.length;a++)c.seotud.push({aadress:b[a].pikkaadress,paadress:b[a].ipikkaadress,lahiaadress:b[a].aadresstekst,liik:b[a].ads_oid.substring(0,2),orig_tunnus:b[a].tunnus,koodaadress:b[a].koodaadress,ehakmk:b[a].ehakmk,ehakov:b[a].ehakov,ehak:b[a].ehak,kood4:b[a].kood4,kood5:b[a].kood5,kood6:b[a].kood6,kood7:b[a].kood7,maakond:b[a].maakond,omavalitsus:b[a].omavalitsus,asustusyksus:b[a].asustusyksus,
vaikekoht:b[a].vaikekoht,liikluspind:b[a].liikluspind,nimi:b[a].nimi,aadress_nr:b[a].aadress_nr,un_tunnus:b[a].unik,ads_oid:b[a].ads_oid,adob_id:b[a].adob_id,adr_id:b[a].adr_id,x:b[a].viitepunkt_y?Number(b[a].viitepunkt_y).toFixed(2):"",y:b[a].viitepunkt_x?Number(b[a].viitepunkt_x).toFixed(2):"",b:b[a].viitepunkt_b?Number(b[a].viitepunkt_b):"",l:b[a].viitepunkt_l?Number(b[a].viitepunkt_l):""});return c}function P(){b(c.container+" .inaadressSearch .ui-select").hide();b(c.container+" .inaadressSearch").width(b(c.container).width())}
function W(a){for(var b=0;b<document.styleSheets.length;b++)if(document.styleSheets[b].href&&0==document.styleSheets[b].href.indexOf(a))return;var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;b.appendChild(c)}function H(a,b){for(var c=0;c<document.scripts.length;c++)if(0==document.scripts[c].src.indexOf(a)){b&&b();return}var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript";
d.src=a;b&&(d.onload=b);c.appendChild(d)}function ga(a,b){if("AY"==b.substring(0,2)||"OV"==b.substring(0,2)||"MK"==b.substring(0,2)||"LO"==b.substring(0,2))return"H\u00dc";if("LP"==b.substring(0,2))return"LP";if("CU"==b.substring(0,2))return"K\u00dc";if("EE"==b.substring(0,2)||"ME"==b.substring(0,2))return"H";if("ER"==b.substring(0,2)||"MR"==b.substring(0,2))return"K";if("KATASTRIYKSUS"==a)return"K\u00dc";if("EHAK"==a)return"H\u00dc";if("TANAV"==a)return"LP";if("VAIKEKOHT"==a)return"VK";if("HOONE"==
a||"EHITIS"==a||"EHITISHOONE"==a)return"H "}function va(a,b){return"AY"==b.substring(0,2)?e["inads.AY"]:"OV"==b.substring(0,2)?e["inads.OV"]:"MK"==b.substring(0,2)?e["inads.MK"]:"LO"==b.substring(0,2)?e["inads.LO"]:"LP"==b.substring(0,2)?e["inads.LP"]:"CU"==b.substring(0,2)?e["inads.CU"]:"EE"==b.substring(0,2)||"ME"==b.substring(0,2)?e["inads.HO"]:"EHAK"==a?e["inads.EHAK"]:"TANAV"==a?e["inads.LP"]:"VAIKEKOHT"==a?e["inads.VK"]:"HOONE"==a||"EHITIS"==a||"EHITISHOONE"==a?e["inads.HO"]:""}function aa(){var a=
0,b=window,c=document;"number"==typeof window.innerWidth?a=b.innerHeight:c.documentElement&&(c.documentElement.clientWidth||c.documentElement.clientHeight)?a=c.documentElement.clientHeight:c.body&&(c.body.clientWidth||c.body.clientHeight)&&(a=c.body.clientHeight);return a}function ra(a,b){if(!a)return alert("Missing adsoid!"),!1;if(!Na(b))return alert("Invalid BBOX!"),!1;if(!1===a instanceof Array)return alert("Incorrect adsoid parameter. Must be array of adsoid values!"),!1;n&&n.clearMarkers();xa(null,
a.join(","),b)}function Na(a){if(!a||!isNaN(a))return!0;a=a.split(",");if(4!=a.length)return!1;for(var b=0;b<a.length;b++)if(isNaN(a[b]))return!1;return!(Number(a[0])>Number(a[2])||Number(a[1])>Number(a[3]))}function I(a){b(c.container+" input[data-type='search']").val(a);b(c.container+" input[data-type='search']").attr("title",a);a?b(c.container+" .ui-input-clear").removeClass("ui-input-clear-hidden"):b(c.container+" .ui-input-clear").addClass("ui-input-clear-hidden")}function sa(a,b){if(B){for(var c=
[],d=0;d<a.length;d++){var e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(Number(a[d].y),Number(a[d].x)));e.attributes={title:a[d].title};c.push(e)}B.removeAllFeatures();B.addFeatures(c);b&&((c=B.getDataExtent())?(d=c.right-c.left,e=c.top-c.bottom,c.left-=.1*d,c.right+=.1*d,c.bottom-=.1*e,c.top+=.1*e):c=void 0,l.zoomToExtent(c,!1))}}var R="1.3.2",A,p,La=10,T=5,q={mapSearch:1,mapSearchHidden:2,addressSearch:3,mapOnly:4},ia=["EHITISHOONE","KATASTRIYKSUS","TANAV","VAIKEKOHT","EHAK"],F=
{allowed:1,all:2},ja={ALUSKAART:"BAASKAART,CORINE,KAART24,HALDUSPIIRID,TEED,KYLAD",ORTOFOTO:"EESTIFOTO",HYBRIID:"EESTIFOTO,HYBRID,ADS_HOONE,ADS_HOONE_NR"},Ba=["KATASTRIYKSUS","AADRESS"],c=U,b,l,k,n,B,z=0,e={},E=510,v=55,u,S,wa="abcdefghijklmnopqrsztuvwxy".split(""),pa,$,X=!0,ca,D={measure:"measure",draw:"draw",edit:"edit"},t,L,J=null,K=null,ba=46,C;U=-1!=navigator.appName.indexOf("Internet Explorer")?-1==navigator.appVersion.indexOf("MSIE 9")&&-1==navigator.appVersion.indexOf("MSIE 1"):!1;if(U)alert("In-ADS component is not supported by your browser!");
else if(Aa()){Ca();var V,G,ea,ya=!1,s;this.hideResult=function(){b(c.container+" .inaadressSearch ul").html("")};this.setAddress=function(a){b&&b(c.container+" input[data-type='search']")&&0<b(c.container+" input[data-type='search']").length?I(a):$=a};this.showMap=function(){c.mode==q.mapSearchHidden&&(b&&b(c.container+" #"+k)&&0<b(c.container+" #"+k).length?(b(c.container+" #"+k).show(),b(c.container).height(b(c.container+" #"+k).is(":visible")?E:b(c.container+" #showHideMap").height()+b(c.container+
" .inaadressSearchContainer form").height()+v),b(c.container+" #showHideMapBtn").val(b(c.container+" #showHideMapBtn").val()==e["inads.showmap"]?e["inads.hidemap"]:e["inads.showmap"]),b(c.container+" #showHideMapBtn").button("refresh")):ca=!0)};this.hideMap=function(){c.mode==q.mapSearchHidden&&(b(c.container+" #"+k).hide(),b(c.container).height(b(c.container+" #"+k).is(":visible")?E:b(c.container+" #showHideMap").height()+b(c.container+" .inaadressSearchContainer form").height()+v),b(c.container+
" #showHideMapBtn").val(b(c.container+" #showHideMapBtn").val()==e["inads.showmap"]?e["inads.hidemap"]:e["inads.showmap"]),b(c.container+" #showHideMapBtn").button("refresh"))};this.searchAddress=function(a,b){ra(a,b)};this.setInfo=function(a){b&&b(c.container+" .inAadressInfoBtn")&&0!=b(c.container+" .inAadressInfoBtn").length?a?b(c.container+" .inAadressInfoBtn").addClass("active"):b(c.container+" .inAadressInfoBtn").removeClass("active"):pa=a};this.closeInfo=function(){u&&u.popup("close")};this.getMap=
function(){return l};this.getLang=function(){return e};this.getMapId=function(){return k};this.toggleFullscreen=function(a){c.fullscreenMode=a;var e=!0===a?aa():E;!0===a&&null==J&&null==K?(J=String(b("body").attr("style")),K=String(b(c.container).attr("style")),b("body").attr("style","margin:0"),b(c.container).attr("style","z-index:1;position:fixed;top:0;left:0;width:100%;height:"+e+"px")):!1===a&&null!=J&&null!=K&&(b("body").attr("style",J),b(c.container).attr("style",K),J=K=null);0<b(c.container+
" .inaadressSearchContainer").length?b(c.container+" #"+k).height(e-ba-v):b(c.container+" #"+k).height(e-v);l.updateSize()};this.clear=function(){P();C.html("");b(c.container+" input[data-type='search']").val("");b(c.container+" input[data-type='search']").attr("title","");b(c.container+" .ui-input-clear").addClass("ui-input-clear-hidden");n&&n.clearMarkers()};this.setMarkers=function(a,b){sa(a,b)};this.clearMarkers=function(){B&&B.removeAllFeatures()};this.pointAddressXY=function(a,b){isNaN(a)||
isNaN(b)||da(b,a,!1)};this.pointAddressLatLon=function(a,b){if(!isNaN(b)&&!isNaN(a)){var c=new OpenLayers.LonLat(b,a);c.transform(new OpenLayers.Projection("EPSG:4326"),"EPSG:3301");da(c.lon,c.lat,!1)}};this.getVersion=function(){return R}}};
